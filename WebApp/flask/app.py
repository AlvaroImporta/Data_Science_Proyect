from flask import Flask, request, jsonify
from flask_cors import CORS
from collections import Counter
import pandas as pd
import joblib
import os

app = Flask(__name__)
CORS(app) # Para permitir peticiones desde cualquier origen

@app.route('/predict', methods=['POST'])
def predict():

    data = request.json
   
    base_dir = os.path.dirname(os.path.abspath(__file__))

    if data['character'] == 'Ironclad':
        ironclad_columns = ["max_hp","entering_hp","Adrenaline","After Image","Alpha","Alpha+1","Anger","Anger+1","Apotheosis","Apotheosis+1","Armaments","Armaments+1","AscendersBane","Backflip+1","Backstab","Backstab+1","Bandage Up","Bandage Up+1","Barricade","Barricade+1","Bash","Bash+1","Battle Trance","Battle Trance+1","Beam Cell","Berserk","Berserk+1","Bite","Bite+1","Blade Dance","Blind","Blind+1","Blood for Blood","Blood for Blood+1","Bloodletting","Bloodletting+1","Bludgeon","Bludgeon+1","Body Slam","Body Slam+1","Brutality","Brutality+1","Buffer","Buffer+1","Burning Pact","Burning Pact+1","Carnage","Carnage+1","Chaos","Chill","Chrysalis","Chrysalis+1","Clash","Clash+1","Cleave","Cleave+1","Cloak And Dagger","Clothesline","Clothesline+1","Clumsy","Combust","Combust+1","Consecrate+1","Conserve Battery","Coolheaded+1","Core Surge","Corpse Explosion","Corruption","Corruption+1","Creative AI","Creative AI+1","Crescendo","Crescendo+1","Crippling Poison+1","CrushJoints","CutThroughFate","CutThroughFate+1","Dagger Spray","Dagger Throw+1","Dark Embrace","Dark Embrace+1","Dark Shackles","Dark Shackles+1","Dash","Dash+1","Decay","DeceiveReality","Deep Breath","Deep Breath+1","Defend_B","Defend_G","Defend_P","Defend_R","Defend_R+1","Demon Form","Demon Form+1","DeusExMachina+1","Devotion","Devotion+1","Disarm","Disarm+1","Discovery","Discovery+1","Dodge and Roll+1","Doom and Gloom","Doppelganger","Double Energy+1","Double Tap","Double Tap+1","Doubt","Dramatic Entrance","Dramatic Entrance+1","Dropkick","Dropkick+1","Dual Wield","Dual Wield+1","Echo Form","Echo Form+1","Enlightenment","Enlightenment+1","Entrench","Entrench+1","Escape Plan","Evaluate+1","Evolve","Evolve+1","Exhume","Exhume+1","Feed","Feed+1","Feel No Pain","Feel No Pain+1","Fiend Fire","Fiend Fire+1","Finesse","Finesse+1","Fire Breathing","Fire Breathing+1","Flame Barrier","Flame Barrier+1","Flash of Steel","Flash of Steel+1","Flex","Flex+1","Flying Knee","Footwork","Footwork+1","Forethought","Forethought+1","Genetic Algorithm","Ghostly","Ghostly Armor","Ghostly Armor+1","Ghostly+1","Glass Knife","Go for the Eyes","Good Instincts","Good Instincts+1","HandOfGreed","HandOfGreed+1","Havoc","Havoc+1","Headbutt","Headbutt+1","Heavy Blade","Heavy Blade+1","Heel Hook","Hemokinesis","Hemokinesis+1","Hyperbeam","Hyperbeam+1","Immolate","Immolate+1","Impatience","Impatience+1","Impervious","Impervious+1","Infernal Blade","Infernal Blade+1","Inflame","Inflame+1","Injury","Intimidate","Intimidate+1","Iron Wave","Iron Wave+1","J.A.X.","J.A.X.+1","Jack Of All Trades","Jack Of All Trades+1","Juggernaut","Juggernaut+1","Leap+1","Leg Sweep","Leg Sweep+1","Limit Break","Limit Break+1","Machine Learning","Machine Learning+1","Madness","Madness+1","Magnetism","Magnetism+1","Master of Strategy","Master of Strategy+1","Mayhem","Mayhem+1","Meditate","Metallicize","Metallicize+1","Metamorphosis","Metamorphosis+1","Meteor Strike","Mind Blast","Mind Blast+1","Night Terror","Normality","Offering","Offering+1","Pain","Panacea","Panacea+1","Panache","Panache+1","PanicButton","PanicButton+1","Parasite","Perfected Strike","Perfected Strike+1","Perseverance","PiercingWail","PiercingWail+1","Poisoned Stab","Pommel Strike","Pommel Strike+1","Power Through","Power Through+1","Predator","Prepared","Protect","Pummel","Pummel+1","Purity","Purity+1","Rage","Rage+1","Ragnarok","Rampage","Rampage+1","ReachHeaven","Reaper","Reaper+1","Rebound","Reckless Charge","Reckless Charge+1","Regret","Reinforced Body+1","Reprogram","Reprogram+1","Riddle With Holes","Riddle With Holes+1","RitualDagger","RitualDagger+1","Rupture","Rupture+1","Sadistic Nature","Sadistic Nature+1","SandsOfTime","Scrape","Scrawl","Searing Blow","Searing Blow+1","Second Wind","Second Wind+1","Secret Technique","Secret Technique+1","Secret Weapon","Secret Weapon+1","Seeing Red","Seeing Red+1","Self Repair","Sentinel","Sentinel+1","Sever Soul","Sever Soul+1","Shame","Shockwave","Shockwave+1","Shrug It Off","Shrug It Off+1","SignatureMove","Skewer+1","Skim","Slice","Slice+1","Spot Weakness","Spot Weakness+1","Steam","Streamline","Strike_B+1","Strike_R","Strike_R+1","Sucker Punch","Sucker Punch+1","Sweeping Beam","Swift Strike","Swift Strike+1","Sword Boomerang","Sword Boomerang+1","The Bomb","The Bomb+1","Thinking Ahead","Thinking Ahead+1","ThirdEye","Thunderclap","Thunderclap+1","Tools of the Trade","Tools of the Trade+1","Transmutation","Transmutation+1","Trip","Trip+1","True Grit","True Grit+1","Turbo+1","Twin Strike","Twin Strike+1","Undo","Uppercut","Uppercut+1","Venomology+1","Violence","Violence+1","Warcry","Warcry+1","WaveOfTheHand","WaveOfTheHand+1","Whirlwind","Whirlwind+1","White Noise","Wild Strike","Wild Strike+1","Wireheading","Wireheading+1","Wraith Form v2","Wraith Form v2+1","Writhe","Akabeko","Anchor","Ancient Tea Set","Art of War","Bag of Marbles","Bag of Preparation","Bird Faced Urn","Black Blood","Black Star","Blood Vial","Bloody Idol","Blue Candle","Boot","Bottled Flame","Bottled Lightning","Bottled Tornado","Brimstone","Bronze Scales","Burning Blood","Busted Crown","Calipers","Calling Bell","CaptainsWheel","Cauldron","Centennial Puzzle","CeramicFish","Champion Belt","Charon's Ashes","Chemical X","CloakClasp","ClockworkSouvenir","Coffee Dripper","CultistMask","Cursed Key","Darkstone Periapt","Dead Branch","Dodecahedron","Dream Catcher","Du-Vu Doll","Ectoplasm","Empty Cage","Enchiridion","Eternal Feather","FaceOfCleric","FossilizedHelix","Frozen Egg 2","Frozen Eye","Fusion Hammer","Gambling Chip","Ginger","Girya","Golden Idol","Gremlin Horn","GremlinMask","HandDrill","Happy Flower","HornCleat","Ice Cream","Incense Burner","InkBottle","Juzu Bracelet","Kunai","Lantern","Lee's Waffle","Letter Opener","Lizard Tail","Magic Flower","Mango","Mark of Pain","Mark of the Bloom","Matryoshka","MawBank","MealTicket","Meat on the Bone","Medical Kit","Membership Card","Mercury Hourglass","Molten Egg 2","Mummified Hand","MutagenicStrength","Necronomicon","NeowsBlessing","Nilry's Codex","Nloth's Gift","NlothsMask","Nunchaku","Odd Mushroom","Oddly Smooth Stone","Old Coin","Omamori","OrangePellets","Orichalcum","Ornamental Fan","Orrery","Pantograph","Paper Frog","Peace Pipe","Pear","Pen Nib","Philosopher's Stone","Pocketwatch","Potion Belt","Prayer Wheel","PreservedInsect","PrismaticShard","Question Card","Red Mask","Red Skull","Regal Pillow","Runic Cube","Runic Dome","Runic Pyramid","SacredBark","Self Forming Clay","Shovel","Shuriken","Singing Bowl","SlaversCollar","Sling","Smiling Mask","Snecko Eye","Sozu","Spirit Poop","SsserpentHead","StoneCalendar","Strange Spoon","Strawberry","StrikeDummy","Sundial","The Courier","TheAbacus","Thread and Needle","Tiny Chest","Tiny House","Toolbox","Torii","Toxic Egg 2","Toy Ornithopter","TungstenRod","Turnip","Unceasing Top","Vajra","Velvet Choker","War Paint","WarpedTongs","Whetstone","White Beast Statue","WingedGreaves"]
        model_path = os.path.join(base_dir,'extra_trees_ironclad.pkl')
        df = pd.DataFrame(0,columns=ironclad_columns,index=range(4))
    elif data['character'] == 'Silent':
        silent_columns = ["max_hp","entering_hp","A Thousand Cuts","A Thousand Cuts+1","Accuracy","Accuracy+1","Acrobatics","Acrobatics+1","Adrenaline","Adrenaline+1","After Image","After Image+1","All For One","All Out Attack","All Out Attack+1","Apotheosis","Apotheosis+1","AscendersBane","Auto Shields","Backflip","Backflip+1","Backstab","Backstab+1","Bandage Up","Bandage Up+1","Bane","Bane+1","Bash","Battle Trance","BattleHymn","Bite","Bite+1","Blade Dance","Blade Dance+1","Blasphemy","Blind","Blind+1","Bludgeon","Blur","Blur+1","Bouncing Flask","Bouncing Flask+1","BowlingBash","Bullet Time","Bullet Time+1","Burst","Burst+1","Calculated Gamble","Calculated Gamble+1","Caltrops","Caltrops+1","Catalyst","Catalyst+1","Chill","Choke","Choke+1","Chrysalis","Chrysalis+1","Cleave+1","Cloak And Dagger","Cloak And Dagger+1","Clothesline","Cold Snap","Cold Snap+1","Concentrate","Concentrate+1","Conclude+1","Conserve Battery","Core Surge","Corpse Explosion","Corpse Explosion+1","Crippling Poison","Crippling Poison+1","Dagger Spray","Dagger Spray+1","Dagger Throw","Dagger Throw+1","Dark Shackles","Dark Shackles+1","Dash","Dash+1","Deadly Poison","Deadly Poison+1","Decay","DeceiveReality+1","Deep Breath","Deep Breath+1","Defend_G","Defend_G+1","Deflect","Deflect+1","Die Die Die","Die Die Die+1","Discovery","Discovery+1","Distraction","Distraction+1","Dodge and Roll","Dodge and Roll+1","Doppelganger","Doppelganger+1","Doubt","Dramatic Entrance","Dramatic Entrance+1","Echo Form","Endless Agony","Endless Agony+1","Enlightenment","Enlightenment+1","Envenom","Envenom+1","Escape Plan","Escape Plan+1","Evaluate","Evaluate+1","Eviscerate","Eviscerate+1","Evolve","Expertise","Expertise+1","FTL","Fasting2","Feel No Pain","Finesse","Finesse+1","Finisher","Finisher+1","Flame Barrier","Flash of Steel","Flash of Steel+1","Flechettes","Flechettes+1","Flex","Flying Knee","Flying Knee+1","FollowUp","Footwork","Footwork+1","Forethought","Forethought+1","Gash","Ghostly","Ghostly+1","Glass Knife","Glass Knife+1","Good Instincts","Good Instincts+1","Grand Finale","Grand Finale+1","HandOfGreed","HandOfGreed+1","Heel Hook","Heel Hook+1","Hello World+1","Hyperbeam","Hyperbeam+1","Impatience","Impatience+1","Impervious","Infinite Blades","Infinite Blades+1","Injury","Iron Wave","Iron Wave+1","J.A.X.","J.A.X.+1","Jack Of All Trades","Jack Of All Trades+1","JustLucky","Leg Sweep","Leg Sweep+1","Machine Learning","Madness","Madness+1","Magnetism","Magnetism+1","Malaise","Malaise+1","Master of Strategy","Master of Strategy+1","MasterReality+1","Masterful Stab","Masterful Stab+1","Mayhem","Mayhem+1","Melter+1","Metallicize","Metamorphosis","Metamorphosis+1","Mind Blast","Mind Blast+1","Neutralize","Neutralize+1","Night Terror","Night Terror+1","Normality","Noxious Fumes","Noxious Fumes+1","Outmaneuver","Outmaneuver+1","Pain","Panacea","Panacea+1","Panache","Panache+1","PanicButton","PanicButton+1","Parasite","PathToVictory+1","Perfected Strike","Phantasmal Killer","Phantasmal Killer+1","PiercingWail","PiercingWail+1","Poisoned Stab","Poisoned Stab+1","Pommel Strike","Pray+1","Predator","Predator+1","Prepared","Prepared+1","Prostrate+1","Protect","Purity","Purity+1","Quick Slash","Quick Slash+1","Rage","Reboot","Recycle","Reflex","Reflex+1","Regret","Reprogram","Riddle With Holes","Riddle With Holes+1","RitualDagger","RitualDagger+1","Sadistic Nature","Sadistic Nature+1","Searing Blow+1","Secret Technique","Secret Technique+1","Secret Weapon","Secret Weapon+1","Setup","Setup+1","Shame","Skewer","Skewer+1","Slice","Slice+1","Static Discharge+1","Storm of Steel","Storm of Steel+1","Strike_G","Strike_G+1","Sucker Punch","Sucker Punch+1","Sunder+1","Survivor","Survivor+1","Swift Strike","Swift Strike+1","Swivel","Tactician","Tactician+1","Terror","Terror+1","The Bomb","The Bomb+1","Thinking Ahead","Thinking Ahead+1","ThirdEye","ThirdEye+1","Tools of the Trade","Tools of the Trade+1","Transmutation","Transmutation+1","Trip","Trip+1","Turbo+1","Underhanded Strike","Underhanded Strike+1","Undo+1","Unload","Unload+1","Uppercut","Venomology","Venomology+1","Violence","Well Laid Plans","Well Laid Plans+1","WheelKick","Wraith Form v2","Wraith Form v2+1","Writhe","Akabeko","Anchor","Ancient Tea Set","Art of War","Bag of Marbles","Bag of Preparation","Bird Faced Urn","Black Star","Blood Vial","Bloody Idol","Blue Candle","Boot","Bottled Flame","Bottled Lightning","Bottled Tornado","Bronze Scales","Busted Crown","Calipers","Calling Bell","CaptainsWheel","Cauldron","Centennial Puzzle","CeramicFish","Chemical X","CloakClasp","ClockworkSouvenir","Coffee Dripper","CultistMask","Cursed Key","Darkstone Periapt","Dead Branch","Dream Catcher","Du-Vu Doll","Ectoplasm","Empty Cage","Enchiridion","Eternal Feather","FaceOfCleric","FossilizedHelix","Frozen Egg 2","Frozen Eye","Fusion Hammer","Gambling Chip","Ginger","Girya","Golden Idol","Gremlin Horn","GremlinMask","HandDrill","Happy Flower","HornCleat","HoveringKite","Ice Cream","Incense Burner","InkBottle","Juzu Bracelet","Kunai","Lantern","Lee's Waffle","Letter Opener","Lizard Tail","Mango","Mark of the Bloom","Matryoshka","MawBank","MealTicket","Meat on the Bone","Medical Kit","Membership Card","Mercury Hourglass","Molten Egg 2","Mummified Hand","MutagenicStrength","Necronomicon","NeowsBlessing","Nilry's Codex","Ninja Scroll","Nloth's Gift","NlothsMask","Nunchaku","Odd Mushroom","Oddly Smooth Stone","Old Coin","Omamori","OrangePellets","Orichalcum","Ornamental Fan","Orrery","Pantograph","Paper Crane","Peace Pipe","Pear","Pen Nib","Philosopher's Stone","Pocketwatch","Potion Belt","Prayer Wheel","PreservedInsect","PrismaticShard","Question Card","Red Mask","Regal Pillow","Ring of the Serpent","Ring of the Snake","Runic Dome","Runic Pyramid","SacredBark","Shovel","Shuriken","Singing Bowl","SlaversCollar","Sling","Smiling Mask","Snake Skull","Snecko Eye","Sozu","Spirit Poop","SsserpentHead","StoneCalendar","Strange Spoon","Strawberry","StrikeDummy","Sundial","The Courier","The Specimen","TheAbacus","Thread and Needle","Tingsha","Tiny Chest","Tiny House","Toolbox","Torii","Tough Bandages","Toxic Egg 2","Toy Ornithopter","TungstenRod","Turnip","TwistedFunnel","Unceasing Top","Vajra","Velvet Choker","WarpedTongs","Whetstone","White Beast Statue","WingedGreaves","WristBlade"]
        model_path = os.path.join(base_dir,'extra_trees_silent.pkl')
        df = pd.DataFrame(0,columns=silent_columns,index=range(4))
    elif data['character'] == 'Defect':
        defect_columns = ["max_hp","entering_hp","Aggregate","Aggregate+1","All For One","All For One+1","Amplify","Amplify+1","Apotheosis","Apotheosis+1","AscendersBane","Auto Shields","Auto Shields+1","Backflip","Ball Lightning","Ball Lightning+1","Bandage Up","Bandage Up+1","Barrage","Barrage+1","Barricade","Barricade+1","Beam Cell","Beam Cell+1","Berserk","Biased Cognition","Biased Cognition+1","Bite","Bite+1","Blade Dance","Blind","Blind+1","Blizzard","Blizzard+1","Body Slam","Body Slam+1","BootSequence","BootSequence+1","Buffer","Buffer+1","Caltrops","Capacitor","Capacitor+1","Chaos","Chaos+1","Chill","Chill+1","Chrysalis","Chrysalis+1","Clash","Cleave","Clumsy","Cold Snap","Cold Snap+1","Collect","Compile Driver","Compile Driver+1","Conserve Battery","Conserve Battery+1","Consume","Consume+1","Coolheaded","Coolheaded+1","Core Surge","Core Surge+1","Creative AI","Creative AI+1","CutThroughFate+1","Dagger Throw","Dark Shackles","Dark Shackles+1","Darkness","Darkness+1","Deadly Poison","Deadly Poison+1","Decay","Deep Breath","Deep Breath+1","Defend_B","Defend_B+1","Defend_P","Defend_R","Deflect","Deflect+1","Defragment","Defragment+1","DeusExMachina","DevaForm","Discovery","Discovery+1","Distraction","Dodge and Roll","Dodge and Roll+1","Doom and Gloom","Doom and Gloom+1","Double Energy","Double Energy+1","Double Tap","Doubt","Dramatic Entrance","Dramatic Entrance+1","Dual Wield","Dual Wield+1","Dualcast","Dualcast+1","Echo Form","Echo Form+1","Electrodynamics","Electrodynamics+1","Enlightenment","Enlightenment+1","Envenom","Establishment","Evaluate","FTL","FTL+1","Finesse","Finesse+1","Fission","Fission+1","Flash of Steel","Flash of Steel+1","Flex","Flying Knee","Footwork+1","Force Field","Force Field+1","Forethought","Forethought+1","Fusion","Fusion+1","Gash","Gash+1","Genetic Algorithm","Genetic Algorithm+1","Ghostly","Ghostly+1","Glacier","Glacier+1","Go for the Eyes","Go for the Eyes+1","Good Instincts","Good Instincts+1","HandOfGreed","HandOfGreed+1","Headbutt","Heatsinks","Heatsinks+1","Hello World","Hello World+1","Hologram","Hologram+1","Hyperbeam","Hyperbeam+1","Impatience","Impatience+1","Impervious+1","Infernal Blade","Infinite Blades","Injury","Iron Wave","Iron Wave+1","J.A.X.","J.A.X.+1","Jack Of All Trades","Jack Of All Trades+1","Leap","Leap+1","Leg Sweep","Lockon","Lockon+1","Loop","Loop+1","Machine Learning","Machine Learning+1","Madness","Madness+1","Magnetism","Magnetism+1","Malaise","Master of Strategy","Master of Strategy+1","Mayhem","Mayhem+1","Melter","Melter+1","Metamorphosis","Metamorphosis+1","Meteor Strike","Meteor Strike+1","Mind Blast","Mind Blast+1","Multi-Cast","Multi-Cast+1","Night Terror","Normality","Noxious Fumes","Noxious Fumes+1","Pain","Panacea","Panacea+1","Panache","Panache+1","PanicButton","PanicButton+1","Parasite","PiercingWail","Pommel Strike","Pommel Strike+1","Predator+1","Protect","Purity","Purity+1","Quick Slash","Rainbow","Rainbow+1","Reboot","Reboot+1","Rebound","Rebound+1","Recycle","Recycle+1","Redo","Redo+1","Regret","Reinforced Body","Reinforced Body+1","Reprogram","Reprogram+1","Rip and Tear","Rip and Tear+1","RitualDagger","RitualDagger+1","Sadistic Nature","Sadistic Nature+1","Scrape","Scrape+1","Secret Technique","Secret Technique+1","Secret Weapon","Secret Weapon+1","Seek","Seek+1","Self Repair","Self Repair+1","Shame","Shrug It Off+1","Skewer","Skim","Skim+1","Slice","Stack","Stack+1","Static Discharge","Static Discharge+1","Steam","Steam Power","Steam Power+1","Steam+1","Storm","Storm+1","Streamline","Streamline+1","Strike_B","Strike_B+1","Sucker Punch","Sunder","Sunder+1","Survivor","Sweeping Beam","Sweeping Beam+1","Swift Strike","Swift Strike+1","Tempest","Tempest+1","The Bomb","The Bomb+1","Thinking Ahead","Thinking Ahead+1","ThirdEye","ThirdEye+1","Thunder Strike","Thunder Strike+1","Thunderclap","Transmutation","Transmutation+1","Trip","Trip+1","True Grit","True Grit+1","Turbo","Turbo+1","Twin Strike+1","Undo","Undo+1","Violence","Violence+1","White Noise","White Noise+1","Writhe","Zap","Zap+1","Akabeko","Anchor","Ancient Tea Set","Art of War","Bag of Marbles","Bag of Preparation","Bird Faced Urn","Black Star","Blood Vial","Bloody Idol","Blue Candle","Boot","Bottled Flame","Bottled Lightning","Bottled Tornado","Bronze Scales","Busted Crown","Cables","Calipers","Calling Bell","CaptainsWheel","Centennial Puzzle","CeramicFish","Chemical X","CloakClasp","ClockworkSouvenir","Coffee Dripper","Cracked Core","CultistMask","Cursed Key","Darkstone Periapt","DataDisk","Dead Branch","Dream Catcher","Du-Vu Doll","Ectoplasm","Emotion Chip","Empty Cage","Enchiridion","Eternal Feather","FaceOfCleric","FossilizedHelix","Frozen Egg 2","Frozen Eye","FrozenCore","Fusion Hammer","Gambling Chip","Ginger","Girya","Golden Idol","Gremlin Horn","GremlinMask","HandDrill","Happy Flower","HornCleat","Ice Cream","Incense Burner","InkBottle","Inserter","Juzu Bracelet","Kunai","Lantern","Lee's Waffle","Letter Opener","Lizard Tail","Mango","Mark of the Bloom","Matryoshka","MawBank","MealTicket","Meat on the Bone","Medical Kit","Membership Card","Mercury Hourglass","Molten Egg 2","Mummified Hand","MutagenicStrength","Necronomicon","NeowsBlessing","Nilry's Codex","Nloth's Gift","NlothsMask","Nuclear Battery","Nunchaku","Odd Mushroom","Oddly Smooth Stone","Old Coin","Omamori","OrangePellets","Orichalcum","Ornamental Fan","Orrery","Pantograph","Peace Pipe","Pear","Pen Nib","Philosopher's Stone","Pocketwatch","Potion Belt","Prayer Wheel","PreservedInsect","PrismaticShard","Question Card","Red Mask","Regal Pillow","Runic Capacitor","Runic Dome","Runic Pyramid","SacredBark","Shovel","Shuriken","Singing Bowl","SlaversCollar","Sling","Smiling Mask","Snecko Eye","Sozu","Spirit Poop","SsserpentHead","StoneCalendar","Strange Spoon","Strawberry","StrikeDummy","Sundial","Symbiotic Virus","The Courier","TheAbacus","Thread and Needle","Tiny Chest","Tiny House","Toolbox","Torii","Toxic Egg 2","Toy Ornithopter","TungstenRod","Turnip","Unceasing Top","Vajra","Velvet Choker","WarpedTongs","Whetstone","White Beast Statue","WingedGreaves"]
        model_path = os.path.join(base_dir,'extra_trees_defect.pkl')
        df = pd.DataFrame(0,columns=defect_columns,index=range(4))
    elif data['character'] == 'Watcher':
        watcher_columns = ["max_hp","entering_hp","Adaptation","Adaptation+1","Alpha","Alpha+1","Apotheosis","Apotheosis+1","AscendersBane","Ball Lightning","Bandage Up","Bandage Up+1","BattleHymn","BattleHymn+1","Bite","Bite+1","Blasphemy","Blasphemy+1","Blind","Blind+1","BowlingBash","BowlingBash+1","Brilliance","Brilliance+1","Burst","CarveReality","CarveReality+1","Chrysalis","Chrysalis+1","ClearTheMind","ClearTheMind+1","Collect","Collect+1","Conclude","Conclude+1","ConjureBlade","ConjureBlade+1","Consecrate","Consecrate+1","Conserve Battery+1","Crescendo","Crescendo+1","CrushJoints","CrushJoints+1","CutThroughFate","CutThroughFate+1","Dark Shackles","Dark Shackles+1","Decay","DeceiveReality","DeceiveReality+1","Deep Breath","Defend_P","Defend_P+1","DeusExMachina","DeusExMachina+1","DevaForm","DevaForm+1","Devotion","Devotion+1","Discovery","Discovery+1","Doubt","Dramatic Entrance","Dramatic Entrance+1","EmptyBody","EmptyBody+1","EmptyFist","EmptyFist+1","EmptyMind","EmptyMind+1","Enlightenment","Eruption","Eruption+1","Establishment","Establishment+1","Evaluate","Evaluate+1","Expertise+1","Fasting2","Fasting2+1","FearNoEvil","FearNoEvil+1","Finesse","Finesse+1","Finisher+1","Flash of Steel","Flash of Steel+1","Flex","FlurryOfBlows","FlurryOfBlows+1","FlyingSleeves","FlyingSleeves+1","FollowUp","FollowUp+1","ForeignInfluence","ForeignInfluence+1","Forethought","Forethought+1","Genetic Algorithm","Ghostly","Ghostly Armor+1","Ghostly+1","Good Instincts","Halt","Halt+1","HandOfGreed","HandOfGreed+1","Hologram+1","Impatience","Impatience+1","Indignation","Indignation+1","Injury","InnerPeace","InnerPeace+1","Iron Wave","J.A.X.","J.A.X.+1","Jack Of All Trades","Judgement","Judgement+1","JustLucky","JustLucky+1","LessonLearned","LessonLearned+1","LikeWater","LikeWater+1","Madness","Madness+1","Magnetism","Magnetism+1","Master of Strategy","Master of Strategy+1","MasterReality","MasterReality+1","Mayhem","Mayhem+1","Meditate","Meditate+1","MentalFortress","MentalFortress+1","Metamorphosis","Metamorphosis+1","Mind Blast","Mind Blast+1","Nirvana","Nirvana+1","Normality","Omniscience","Omniscience+1","Pain","Panacea","Panacea+1","Panache","Panache+1","PanicButton","PanicButton+1","Parasite","PathToVictory","PathToVictory+1","Perseverance","Perseverance+1","Pommel Strike+1","Pray","Pray+1","Prostrate","Prostrate+1","Protect","Protect+1","Purity","Ragnarok","Ragnarok+1","ReachHeaven","ReachHeaven+1","Regret","Riddle With Holes","RitualDagger","RitualDagger+1","Sadistic Nature","Sadistic Nature+1","Sanctity","Sanctity+1","SandsOfTime","SandsOfTime+1","SashWhip","SashWhip+1","Scrawl","Scrawl+1","Secret Technique","Secret Weapon","Shame","Shrug It Off","SignatureMove","SignatureMove+1","SpiritShield","SpiritShield+1","Stack","Strike_P","Strike_P+1","Study","Study+1","Swift Strike","Swivel","Swivel+1","TalkToTheHand","TalkToTheHand+1","Tantrum","Tantrum+1","The Bomb","Thinking Ahead","Thinking Ahead+1","ThirdEye","ThirdEye+1","Transmutation","Transmutation+1","Trip","Trip+1","Vault","Vault+1","Vengeance","Vengeance+1","Vigilance","Vigilance+1","Violence","Violence+1","Wallop","Wallop+1","WaveOfTheHand","WaveOfTheHand+1","Weave","Weave+1","WheelKick","WheelKick+1","WindmillStrike","WindmillStrike+1","Wireheading","Wireheading+1","Wish","Wish+1","Worship","Worship+1","WreathOfFlame","WreathOfFlame+1","Writhe","Akabeko","Anchor","Ancient Tea Set","Art of War","Bag of Marbles","Bag of Preparation","Bird Faced Urn","Black Star","Blood Vial","Bloody Idol","Blue Candle","Boot","Bottled Flame","Bottled Lightning","Bottled Tornado","Bronze Scales","Busted Crown","Calipers","Calling Bell","CaptainsWheel","Cauldron","Centennial Puzzle","CeramicFish","Chemical X","CloakClasp","ClockworkSouvenir","Coffee Dripper","CultistMask","Cursed Key","Damaru","Darkstone Periapt","Dead Branch","Dream Catcher","Du-Vu Doll","Ectoplasm","Empty Cage","Enchiridion","Eternal Feather","FaceOfCleric","FossilizedHelix","Frozen Egg 2","Frozen Eye","Fusion Hammer","Gambling Chip","Ginger","Girya","Golden Idol","GoldenEye","Gremlin Horn","GremlinMask","HandDrill","Happy Flower","HornCleat","Ice Cream","Incense Burner","InkBottle","Juzu Bracelet","Kunai","Lantern","Lee's Waffle","Letter Opener","Lizard Tail","Mango","Mark of the Bloom","Matryoshka","MawBank","MealTicket","Meat on the Bone","Medical Kit","Melange","Membership Card","Mercury Hourglass","Molten Egg 2","Mummified Hand","MutagenicStrength","NeowsBlessing","Nilry's Codex","Nloth's Gift","NlothsMask","Nunchaku","Odd Mushroom","Oddly Smooth Stone","Old Coin","Omamori","OrangePellets","Orichalcum","Ornamental Fan","Pantograph","Peace Pipe","Pear","Pen Nib","Philosopher's Stone","Pocketwatch","Potion Belt","Prayer Wheel","PreservedInsect","PrismaticShard","PureWater","Question Card","Red Mask","Regal Pillow","Runic Dome","Runic Pyramid","SacredBark","Shovel","Shuriken","Singing Bowl","SlaversCollar","Sling","Smiling Mask","Snecko Eye","Sozu","Spirit Poop","SsserpentHead","StoneCalendar","Strange Spoon","Strawberry","StrikeDummy","Sundial","TeardropLocket","The Courier","TheAbacus","Thread and Needle","Tiny Chest","Toolbox","Torii","Toxic Egg 2","Toy Ornithopter","TungstenRod","Turnip","Unceasing Top","Vajra","Velvet Choker","VioletLotus","WarpedTongs","Whetstone","White Beast Statue","WingedGreaves","Yang"]
        model_path = os.path.join(base_dir,'extra_trees_watcher.pkl')
        df = pd.DataFrame(0,columns=watcher_columns,index=range(4))
    else:
        return jsonify({'error': 'Invalid character'})
    
    model = joblib.load(model_path)

    # Obtener los datos enviados desde el frontend
    df['max_hp'] = data['max_hp']
    df['entering_hp'] = data['entering_hp']

    predictions = []

    if 'card_options' in data:
        card_options = data['card_options']
        relics = data['relics']

        for relic in relics:
            df[relic] = 1

        for index, cards in enumerate(card_options):
            counter = Counter(cards)
            for key, value in counter.items():
                if key in df.columns:
                    df.at[index, key] = value

            # Hacer la predicción
            prediction = model.predict(df.iloc[[index]])
            predictions.append(prediction.tolist())
        
    elif 'relic_options' in data:
        relic_options = data['relic_options']
        cards = data['cards']
    
        for card in cards:
            df[card] = 1

        for index, relics in enumerate(relic_options):
            counter = Counter(relics)
            for key, value in counter.items():
                if key in df.columns:
                    df.at[index, key] = value
            
            # Hacer la predicción
            prediction = model.predict(df.iloc[[index]])
            predictions.append(prediction.tolist())
    
    # Responder al frontend con las predicciones
    return jsonify(predictions)

if __name__ == '__main__':
    app.run(debug=True)